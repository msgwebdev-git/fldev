## 9. –í—ã–≤–æ–¥—ã –¥–ª—è B2B

### 9.1 –ß—Ç–æ –º–æ–∂–µ–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- –¢–∞–±–ª–∏—Ü—ã `tickets`, `ticket_options` - –∫–∞–∫ –µ—Å—Ç—å
- –¢–∞–±–ª–∏—Ü–∞ `orders` - —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è B2B
- –¢–∞–±–ª–∏—Ü–∞ `order_items` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- –¢–∞–±–ª–∏—Ü–∞ `email_logs` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤:**
- PDFKit –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä - –≥–æ—Ç–æ–≤
- QR-–∫–æ–¥—ã - –≥–æ—Ç–æ–≤—ã
- Supabase Storage - –≥–æ—Ç–æ–≤
- Email —Å–µ—Ä–≤–∏—Å - –≥–æ—Ç–æ–≤

‚úÖ **–ü–ª–∞—Ç—ë–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:**
- MAIB –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è - –≥–æ—Ç–æ–≤–∞
- Callback –æ–±—Ä–∞–±–æ—Ç–∫–∞ - –≥–æ—Ç–æ–≤–∞
- Mock —Ä–µ–∂–∏–º - –≥–æ—Ç–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

‚úÖ **Admin —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è/–ø–æ–∏—Å–∫ - –≥–æ—Ç–æ–≤
- –≠–∫—Å–ø–æ—Ä—Ç CSV - –≥–æ—Ç–æ–≤
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - —á–∞—Å—Ç–∏—á–Ω–æ –≥–æ—Ç–æ–≤

### 9.2 –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å

‚ùå **–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
```sql
-- B2B –∑–∞–∫–∞–∑—ã
b2b_orders:
  - id
  - order_number
  - company_name
  - company_tax_id
  - contact_name, contact_email, contact_phone
  - payment_method (enum: 'online', 'invoice')
  - status (pending, invoice_sent, paid, tickets_sent, completed, cancelled)
  - total_amount, discount_percent, discount_amount, final_amount
  - invoice_url
  - notes
  - created_at, updated_at

-- –ü–æ–∑–∏—Ü–∏–∏ B2B –∑–∞–∫–∞–∑–∞
b2b_order_items:
  - id
  - order_id (FK -> b2b_orders)
  - ticket_id (FK -> tickets)
  - quantity
  - unit_price
  - discount_percent
  - total_price

-- –ò—Å—Ç–æ—Ä–∏—è B2B –∑–∞–∫–∞–∑–æ–≤
b2b_order_history:
  - id
  - order_id
  - status
  - changed_by (admin user_id)
  - note
  - created_at
```

‚ùå **–ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–∞–∫–µ—Ç–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ
- –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ (10-20%)
- –§–æ—Ä–º–∞ B2B –∑–∞–∫–∞–∑–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤ (PDF)
- –ú–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤
- Admin –ø–∞–Ω–µ–ª—å B2B:
  - –°–ø–∏—Å–æ–∫ B2B –∑–∞–∫–∞–∑–æ–≤
  - –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∏–ª–µ—Ç–æ–≤
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏

‚ùå **–ù–æ–≤—ã–µ API:**
```
POST   /api/b2b/calculate-discount
POST   /api/b2b/create-order
POST   /api/b2b/orders/:id/generate-invoice
POST   /api/b2b/orders/:id/generate-tickets
POST   /api/b2b/orders/:id/send-tickets
PATCH  /api/b2b/orders/:id/mark-paid
```

‚ùå **–ù–æ–≤—ã–µ email —à–∞–±–ª–æ–Ω—ã:**
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ B2B –∑–∞–∫–∞–∑–∞
- –°—á—ë—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É (PDF –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∏–ª–µ—Ç–æ–≤
- –û—Ç–ø—Ä–∞–≤–∫–∞ –±–∏–ª–µ—Ç–æ–≤ (ZIP –∞—Ä—Ö–∏–≤)

### 9.3 –ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è B2B

| –ê—Å–ø–µ–∫—Ç | B2C (—Ç–µ–∫—É—â–∞—è) | B2B (–ø–ª–∞–Ω–∏—Ä—É–µ–º–∞—è) |
|--------|--------------|------------------|
| **–ú–∏–Ω–∏–º—É–º –±–∏–ª–µ—Ç–æ–≤** | 1 | 50 |
| **–°–∫–∏–¥–∫–∞** | 0-50% (–ø—Ä–æ–º–æ–∫–æ–¥) | 10-20% (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è) |
| **–û–ø–ª–∞—Ç–∞** | –¢–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω | –û–Ω–ª–∞–π–Ω –∏–ª–∏ –ø–æ —Å—á—ë—Ç—É |
| **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤** | –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã | –í—Ä—É—á–Ω—É—é –∏–ª–∏ –∞–≤—Ç–æ |
| **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** | –ò–º—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è | –ò–º—è –∫–æ–º–ø–∞–Ω–∏–∏ + —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ |
| **Email** | 1 –∞–¥—Ä–µ—Å | –ù–µ—Å–∫–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–æ–≤ |
| **–°—Ç–∞—Ç—É—Å—ã** | 6 —Å—Ç–∞—Ç—É—Å–æ–≤ | 6+ —Å—Ç–∞—Ç—É—Å–æ–≤ (invoice_sent, tickets_sent) |
| **–°—á–µ—Ç–∞** | –ù–µ—Ç | PDF —Å—á—ë—Ç |
| **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** | –ë–∞–∑–æ–≤–∞—è | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –æ—Ç–ø—Ä–∞–≤–∫–∞) |

### 9.4 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (ticket.ts, ticket-pdfkit.ts)
- Email —Å–µ—Ä–≤–∏—Å (—Ä–∞—Å—à–∏—Ä–∏—Ç—å —à–∞–±–ª–æ–Ω–∞–º–∏)
- –ü–ª–∞—Ç—ë–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å (MAIB)
- –•—Ä–∞–Ω–∏–ª–∏—â–µ (Supabase Storage)

‚úÖ **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ:**
- `b2b-order.ts` - —Å–µ—Ä–≤–∏—Å B2B –∑–∞–∫–∞–∑–æ–≤
- `invoice.ts` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤
- `b2b-discount.ts` - –ª–æ–≥–∏–∫–∞ —Å–∫–∏–¥–æ–∫
- `b2b-email.ts` - B2B —à–∞–±–ª–æ–Ω—ã

‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- **–û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** (b2b_orders vs orders) - –ª–µ–≥—á–µ —É–ø—Ä–∞–≤–ª—è—Ç—å
- **–û–±—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF, email) - DRY –ø—Ä–∏–Ω—Ü–∏–ø
- **–†–∞–∑–¥–µ–ª—å–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞** (/admin/b2b-orders vs /admin/orders) - —Ä–∞–∑–Ω—ã–π UX
- **API versioning** (/api/v1/b2b/) - –¥–ª—è –±—É–¥—É—â–µ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

---

## 10. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–ù–µ–¥–µ–ª—è 1) ‚úÖ DONE
- [x] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è B2B —Ç–∞–±–ª–∏—Ü
- [x] –î–æ–±–∞–≤–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- [x] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –≠—Ç–∞–ø 2: Backend API (–ù–µ–¥–µ–ª—è 2) ‚úÖ DONE
- [x] –°–µ—Ä–≤–∏—Å b2b-discount.ts - –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —Å–∫–∏–¥–∫–∏ 10-20%
- [x] –°–µ—Ä–≤–∏—Å b2b-order.ts - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
- [x] –°–µ—Ä–≤–∏—Å b2b-invoice.ts - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —Å—á–µ—Ç–æ–≤
- [x] API endpoints (9 endpoints –≤ /routes/b2b.ts)
- [ ] –¢–µ—Å—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –≠—Ç–∞–ø 3: Frontend (–ù–µ–¥–µ–ª—è 3-4) ‚úÖ DONE
- [x] –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–∞–∫–µ—Ç–∞ (B2BPackageCalculator.tsx)
- [x] –§–æ—Ä–º–∞ B2B –∑–∞–∫–∞–∑–∞ (B2BOrderForm.tsx)
- [x] –°–µ–∫—Ü–∏—è –∑–∞–∫–∞–∑–∞ (B2BOrderSection.tsx)
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ B2BContent.tsx
- [x] –ü–µ—Ä–µ–≤–æ–¥—ã RO/RU –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] Email —à–∞–±–ª–æ–Ω—ã (—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ backend)

### –≠—Ç–∞–ø 4: Admin –ø–∞–Ω–µ–ª—å (–ù–µ–¥–µ–ª—è 5) ‚úÖ DONE
- [x] –°–ø–∏—Å–æ–∫ B2B –∑–∞–∫–∞–∑–æ–≤
- [x] –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
- [x] –û–ø–µ—Ä–∞—Ü–∏–∏ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –æ—Ç–ø—Ä–∞–≤–∫–∞)
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ù–µ–¥–µ–ª—è 6)
- [ ] Unit —Ç–µ—Å—Ç—ã
- [ ] Integration —Ç–µ—Å—Ç—ã
- [ ] E2E —Ç–µ—Å—Ç—ã
- [ ] Load —Ç–µ—Å—Ç—ã

---

**–î–æ–∫—É–º–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ B2B —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞! üöÄ**